---
icon: fa-solid fa-scroll
category:
  - 使用指南
tag:
  - 应用
  - 主界面
  - 规则
  - 行动
  - 变量
  - 触发器
  - 自动化
---

# 自动化

::: info ClassIsland 欢迎您参与完善本条目☆Kira~

欢迎正在阅读这个条目的您协助编辑本条目。编辑前请阅读[条目编辑规范](../community/contributing.html)，并查找相关资料。ClassIsland 祝您在本文档度过愉快的时光。

:::

::: info 该文档需要完善的部分内容  

- 自动化简介  
- 规则集触发条件  
- 窗口规则调试工具的详细说明和Url链接  
- 将技术细节合并进对应位置或独立为单独的章节（可能需要）  
- 合适的配套示意图  
- 规范的Markdown文本格式 ~~（有很多换行处忘了加两个空格）~~
- cron详细事项的补充  
- ~~还有啥一时想不起来了（）~~  

:::

**自动化**是 ClassIsland 1.6 (Himeko) 的新增功能，旨在提供简单快捷的自动操作。  

比如，您可以…

- 在视频展台开启时，自动将主界面移到屏幕右上角，并仅显示当前课程的倒计时；
- 在数学课前，自动打开白板；
- 放学后，自动关闭设备。

如果需要更高级的自动化功能，您还可以搭配专业自动化软件使用，如 [zTasker](https://everauto.net/cn/index.html)、[Power Automate](https://www.microsoft.com/zh-cn/power-platform/products/power-automate)

> [!warning]
> 自动化允许自动修改 ClassIsland 的各项设置，并调用外部程序，可能有一定安全风险。
> 不当的自动化编写可能对正常教学造成影响，请勿滥用。

> [!important]
> 自动化目前正在早期开发中，不建议用于生产环境。此功能在未来可能会产生较大的变动，并且**可能无法保证配置文件完全向下兼容**。欢迎在 [ClassIsland/ClassIsland#119](https://github.com/ClassIsland/ClassIsland/issues/119/) 讨论此功能。

## 概述

### 自动化

**自动化** (Automation)，曾称为**规则行动组**、**条件行动对**，即一对【规则集】与【行动】的组合。

![自动化设置界面](image\automation\自动化：应用设置界面.png)

### 触发器

**触发器** 可以定义一些特定事件发生时触发自动化操作。该功能需要在1.5.4.1及以上版本中使用。

![触发器](image\automation\触发器.png)

`收到信号时`，是指收到“[行动](#行动)”中相应的“广播信号”的事件。  
例如，你在其他自动化流程中设置的`广播信号：信号1`行动执行时，触发器`收到信号时：信号1`将被触发，将会执行该触发器所在的自动化流程。  
`调用uri时`，在调用以下两种uri时触发：`classisland://app/api/automation/run/xxx`或`classisland://app/api/automation/revert/xxx`。__参阅[Uri导航](./uri-navigation.md)，需要启用[【注册Url协议】](./uri-navigation.md#注册-url-协议)选项__。
`规则集更新时`，在满足规则集设定时触发。 参见[规则集](#规则集)。 
`上课时`、`下课时`、`课间休息时` 和 `放学时` ，指当这些时间事件发生时触发事件。  
`当前时间状态变化时`，即前面所述`上课时`、`下课时`、`课间休息时` 和 `放学时` 四种时间事件任意一种触发时。  
`cron`是一种定时触发的触发器，即`时间触发器`。因篇幅所限，这里不再赘述。你可以自行使用搜索引擎查询有关事项和在线的格式转换器。  
`应用启动时`、`应用退出时`，名如其意，指在这两个事件发生时触发的触发器。

### 规则集

**规则集** (Ruleset) 可以定义一些行为的触发条件。你也可以在主界面的高级隐藏规则和组件的隐藏规则等地方见到它。

> [!tip] 
> 在1.5.4.0及以上版本中，只有打开了`并且满足以下规则时`前面的那个开关,才能对规则集进行设置（早期版本中设定的规则集会保留到新版本中，因此您无需担心丢失问题）；只有设置了`规则集更新时`触发器，才能仅在规则集规则发生变化时触发行动；如果不设置`规则集更新时`触发器，则会在其他触发器被触发并且满足规则时执行行动。  

![规则集示例](image\automation\规则集示例.png)

规则集中的【前台窗口类名】、【前台窗口标题】，是指当前“焦点窗口”（也可以理解为正在使用的窗口）的类名或标题。而【前台窗口进程】，则是指当前“焦点窗口”的进程名。  
你可以通过[Catch_Window_Tool](https://github.com/SRInternet-Studio/Catch_Window_Tool)或微软官方开发的Spy++工具查看某一个窗口的类名、标题和进程名。  
或者，你也可以使用ClassIsland自带的`窗口规则调试工具`。你可以在设置-更多（右上角三个点）-调试窗口规则打开它。打开后，该工具会将自身置顶，方便查看信息的同时又不会被遮挡；点击想要查询的窗口即可获得窗口句柄、窗口类名、窗口标题、窗口状态和窗口进程名等信息。    


### 行动

**行动** (Action) 则可以定义一些操作，如更改应用设置、启动指定程序等。

> [!tip] 
> 在1.5.4.1及以上版本中，你在[【编辑档案】-【时间表】](./profile/time-layout.md)中也可以添加【行动】。

![行动示例](image\automation\行动示例.png)

`显示天气提醒`，是指弹出应用[主界面](basic.md#主界面)的天气[提醒](notifications.md)，你可以选择`三天天气预报`（默认）、`逐小时天气预报`或`气象预警`。
>[!tip]  
>当地没有任何气象预警时，`气象预警`不会生效。  

`广播信号`，参见 [触发器](#触发器)-收到信号时，可以发出一个应用内的广播信号，以触发其他自动化流程。  
`组件配置方案`，可以修改[组件](basic.md#组件)的配置方案（不同的json文件）。  
`应用主题`，可以改变应用[主界面](basic.md#主界面)的主题，包括`明亮`、`黑暗`或`跟随系统`。  
`窗口停靠位置`，可以改变应用[主界面](basic.md#主界面)的大致显示位置，如左上角、中上角、右下角等。  
`运行`，可以执行外部指令，如应用程序、网页或cmd命令等。  
> [!warning]  
> 执行外部指令前，请务必检查该外部指令是否安全。由于执行未知的外部来源指令造成的任何损失，ClassIsland不负任何责任。  

`显示提醒`，是指弹出应用[主界面](basic.md#主界面)的[提醒](notifications.md)，包括遮罩和正文。可以自定义遮罩内容和持续时长、正文内容和持续时长。可选遮罩和正文的语音播报（默认启用）。
>[!tip]
>目前文本持续时长为0时，会无法正常提醒。  

`等待时长`，用于延时执行行动。  

当规则集被满足时，其对应的行动会自动触发。当规则集不再满足时，已经执行的行动也将会自动恢复。比如，已修改的应用设置将被自动改回。

![触发和恢复](image\automation\触发和恢复.png)

您也可以点击自动化设置页面右上角的【触发】和【恢复】来测试行动。  

## 配置方案

和组件一样，您可以为自动化切换多个不同的配置文件，或者随时禁用所有或指定的自动化。

![自动化开关和配置方案示意](image\automation\自动化开关和配置方案.png)

您也可以来 [🙌展示台](https://github.com/ClassIsland/ClassIsland/discussions/categories/%E7%BB%84%E4%BB%B6%E9%85%8D%E7%BD%AE%E5%88%86%E4%BA%AB) 与大家分享你的自动化方案。

## 技术细节

1. 您可以拖动自动化进行排序，它们将会按照从上到下的顺序依次开始执行。

![拖动自动化以进行排序](image\automation\排序自动化.png)

2. 行动会创建一个 **设置叠层** (SettingsOverlay) 对应用设置进行临时更改，以便于多个行动的恢复。不过在临时更改期间，如果您手动修改了某个设置，那么该设置项将遵循手动的修改，不会再被恢复。

3. 设置叠层会遵循先来后到的顺序依次往上叠加。因此，如果您希望某一行动始终生效，需要对其他自动化的规则集设置排除以进行规避。

4. 在编辑完组件、自动化或档案后，请勿直接关机，这可能导致您的更改丢失。您需要手动关闭应用设置窗口（或手动退出 ClassIsland）以触发这些配置的保存。
